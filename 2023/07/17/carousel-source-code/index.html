<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>XingYeBlog | XingYeBlog</title><meta name="author" content="Xing Ye,632885485@qq.com"><meta name="copyright" content="Xing Ye"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="轮播图是怎么实现的？下面是react-native-snap-carousel的主要代码。忽略animated相关的模块并删除一些非核心代码，剩下的代码主要如下所示。 在 rn 上轮播组件的设计可以通过 FlatList 来实现。FlatList 本身具有虚拟列表的优化，即使创建多个元素，也能有较好的性能。 这个轮播组件有几个关键的设计点  无限循环：轮播组件的最常用的无限循环方式是这样：  假设">
<meta property="og:type" content="article">
<meta property="og:title" content="XingYeBlog">
<meta property="og:url" content="http://example.com/2023/07/17/carousel-source-code/index.html">
<meta property="og:site_name" content="XingYeBlog">
<meta property="og:description" content="轮播图是怎么实现的？下面是react-native-snap-carousel的主要代码。忽略animated相关的模块并删除一些非核心代码，剩下的代码主要如下所示。 在 rn 上轮播组件的设计可以通过 FlatList 来实现。FlatList 本身具有虚拟列表的优化，即使创建多个元素，也能有较好的性能。 这个轮播组件有几个关键的设计点  无限循环：轮播组件的最常用的无限循环方式是这样：  假设">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/codes1.jpg">
<meta property="article:published_time" content="2023-07-16T17:12:50.276Z">
<meta property="article:modified_time" content="2023-07-14T22:15:27.760Z">
<meta property="article:author" content="Xing Ye">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/codes1.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://example.com/2023/07/17/carousel-source-code/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'XingYeBlog',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-07-15 06:15:27'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/pinkstar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/codes1.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">XingYeBlog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-16T17:12:50.276Z" title="发表于 2023-07-17 01:12:50">2023-07-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-14T22:15:27.760Z" title="更新于 2023-07-15 06:15:27">2023-07-15</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>21分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>轮播图是怎么实现的？<br>下面是react-native-snap-carousel的主要代码。忽略animated相关的模块并删除一些非核心代码，剩下的代码主要如下所示。</p>
<p>在 rn 上轮播组件的设计可以通过 FlatList 来实现。FlatList 本身具有虚拟列表的优化，即使创建多个元素，也能有较好的性能。</p>
<p>这个轮播组件有几个关键的设计点</p>
<ol>
<li>无限循环：轮播组件的最常用的无限循环方式是这样：</li>
</ol>
<p>假设一共有 N 个元素，那么列表的总宽度设置为 N+2 个元素的宽度。<br>例子如下，两端填充如图，当处于一端时，且即将进入循环状态的时候，如第二张图，从状态 1 滑动到状态 2，在滑动结束的时候，将当前的位置直接转到状态 3，直接 scrollTo 滚动到状态 3 的元素的位置。由于这个 scrollTo 是不带动画的，因此用户感觉不到滚动的发生。</p>
<p><img src="https://pic.imgdb.cn/item/64b1131f1ddac507cc53a3a6.jpg"></p>
<p>我们可以将元素扩充，直接把两边的用于缓冲的元素加入到渲染的 data 中。如下代码就是库内的实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loopClonesPerSide表示要在两边增加的额外元素数量</span></span><br><span class="line"><span class="comment">// loopClonesPerSide会影响在用户快速拖动时，看到的空白区域时间。如果过小，那么可能还没来得及瞬间跳转（scroll还没停止），这时会显示空白；如果数量合适，那么即使还没scroll停止，也能看到最新的元素</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> previousItems = []; <span class="comment">// previousItems是data从后向前裁剪，放在data前面</span></span><br><span class="line"><span class="keyword">let</span> nextItems = []; <span class="comment">// nextItems则是从前向后，放在data后面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (loopClonesPerSide &gt; dataLength) &#123;</span><br><span class="line">  <span class="keyword">const</span> dataMultiplier = <span class="built_in">Math</span>.floor(loopClonesPerSide / dataLength);</span><br><span class="line">  <span class="keyword">const</span> remainder = loopClonesPerSide % dataLength;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dataMultiplier; i++) &#123;</span><br><span class="line">    previousItems.push(...data);</span><br><span class="line">    nextItems.push(...data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  previousItems.unshift(...data.slice(-remainder));</span><br><span class="line">  nextItems.push(...data.slice(<span class="number">0</span>, remainder));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  previousItems = data.slice(-loopClonesPerSide);</span><br><span class="line">  nextItems = data.slice(<span class="number">0</span>, loopClonesPerSide);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最后按照顺序合并。参考上面的实现原理就能理解</span></span><br><span class="line"><span class="keyword">return</span> previousItems.concat(data, nextItems);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>元素定位：即如何从 offset 对应到具体的元素，以及用户滚动得到偏移量后，如何定位到最近的元素。</li>
</ol>
<p>方法就是设置一个数据结构 positions 数组，用于记录每个元素的 start 和 end</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// _getCustomData就是如上所述，为了实现loop扩充了data</span></span><br><span class="line"><span class="built_in">this</span>._getCustomData(props).forEach(<span class="function">(<span class="params">itemData, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 这里的index是不真实的index，是复制过后的，但在布局中是基准</span></span><br><span class="line">  <span class="comment">// _index才是原本在data中的index</span></span><br><span class="line">  <span class="keyword">const</span> _index = <span class="built_in">this</span>._getCustomIndex(index, props);</span><br><span class="line">  <span class="keyword">let</span> animatedValue;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>._positions[index] = &#123;</span><br><span class="line">    <span class="attr">start</span>: index * sizeRef,</span><br><span class="line">    <span class="attr">end</span>: index * sizeRef + sizeRef,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在滚动得到本次的 offset 时，根据 offset 得出中心的位置，然后检查有哪个元素恰好在中心线的两边，那就选定是这个元素了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">_getActiveItem</span>(<span class="params">offset</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; activeSlideOffset, swipeThreshold &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">  <span class="keyword">const</span> center = <span class="built_in">this</span>._getCenter(offset); <span class="comment">//</span></span><br><span class="line">  <span class="keyword">const</span> centerOffset = activeSlideOffset || swipeThreshold;</span><br><span class="line">  <span class="comment">// 这里是定位元素的关键</span></span><br><span class="line">  <span class="comment">// 如果没有centerOffset，那么确定当前是哪个元素的方法就是center &gt;= start &amp;&amp; center &lt;= end，即center应该在元素的宽度范围内</span></span><br><span class="line">  <span class="comment">// 加上了centerOffset，其实是缩小了范围，相当于center &gt;= start - centerOffset &amp;&amp; center &lt;= end + centerOffset，这样可能移动更小的距离就会到下一个元素去</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>._positions.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; start, end &#125; = <span class="built_in">this</span>._positions[i];</span><br><span class="line">    <span class="keyword">if</span> (center + centerOffset &gt;= start &amp;&amp; center - centerOffset &lt;= end) &#123;</span><br><span class="line">      <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>下面是精简后的全部代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据props选择scrollView或FlatList</span></span><br><span class="line"><span class="keyword">const</span> AnimatedFlatList = FlatList</span><br><span class="line">  ? Animated.createAnimatedComponent(FlatList)</span><br><span class="line">  : <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">const</span> AnimatedScrollView = Animated.createAnimatedComponent(ScrollView);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Carousel</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    <span class="comment">// 一大堆props</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    <span class="comment">// props默认值</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">hideCarousel</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">interpolators</span>: [],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一些关键的全局变量</span></span><br><span class="line">    <span class="keyword">const</span> initialActiveItem = <span class="built_in">this</span>._getFirstItem(props.firstItem); <span class="comment">// 初始化的第一个元素</span></span><br><span class="line">    <span class="built_in">this</span>._activeItem = initialActiveItem; <span class="comment">// 当前active的元素</span></span><br><span class="line">    <span class="built_in">this</span>._previousActiveItem = initialActiveItem;</span><br><span class="line">    <span class="built_in">this</span>._previousFirstItem = initialActiveItem;</span><br><span class="line">    <span class="built_in">this</span>._previousItemsLength = initialActiveItem;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>._positions = []; <span class="comment">// 记录每个元素的start、end偏移量，很重要。通过positions可以确定每个元素的显隐，以及当前active的元素是哪个。</span></span><br><span class="line">    <span class="built_in">this</span>._setScrollHandler(props);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在挂载阶段定位第一个渲染的元素，移动到第一个元素，并启动autoplay</span></span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; apparitionDelay, autoplay, firstItem &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> _firstItem = <span class="built_in">this</span>._getFirstItem(firstItem);</span><br><span class="line">    <span class="keyword">const</span> apparitionCallback = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(&#123; <span class="attr">hideCarousel</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">      <span class="keyword">if</span> (autoplay) &#123;</span><br><span class="line">        <span class="built_in">this</span>.startAutoplay();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>._mounted = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">this</span>._initPositionsAndInterpolators(); <span class="comment">// 初始化position信息</span></span><br><span class="line"></span><br><span class="line">    requestAnimationFrame(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">this</span>._mounted) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>._snapToItem(_firstItem, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">false</span>); <span class="comment">// 滚动到第一个元素，让第一个元素的start（左边）对齐容器的起点（左边）</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (apparitionDelay) &#123;</span><br><span class="line">        <span class="built_in">this</span>._apparitionTimeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          apparitionCallback();</span><br><span class="line">        &#125;, apparitionDelay);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        apparitionCallback();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 这里就是一个简单的优化，浅比较props</span></span><br><span class="line">  <span class="function"><span class="title">shouldComponentUpdate</span>(<span class="params">nextProps, nextState</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.props.shouldOptimizeUpdates === <span class="literal">false</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> shallowCompare(<span class="built_in">this</span>, nextProps, nextState);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这里主要是针对宽高等关键布局信息的props改变时，重新计算的过程</span></span><br><span class="line">  <span class="function"><span class="title">componentDidUpdate</span>(<span class="params">prevProps</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; interpolators &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      firstItem,</span><br><span class="line">      itemHeight,</span><br><span class="line">      itemWidth,</span><br><span class="line">      scrollEnabled,</span><br><span class="line">      sliderHeight,</span><br><span class="line">      sliderWidth,</span><br><span class="line">    &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> itemsLength = <span class="built_in">this</span>._getCustomDataLength(<span class="built_in">this</span>.props);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!itemsLength) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> nextFirstItem = <span class="built_in">this</span>._getFirstItem(firstItem, <span class="built_in">this</span>.props);</span><br><span class="line">    <span class="keyword">let</span> nextActiveItem =</span><br><span class="line">      <span class="built_in">this</span>._activeItem || <span class="built_in">this</span>._activeItem === <span class="number">0</span></span><br><span class="line">        ? <span class="built_in">this</span>._activeItem</span><br><span class="line">        : nextFirstItem;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> hasNewSliderWidth =</span><br><span class="line">      sliderWidth &amp;&amp; sliderWidth !== prevProps.sliderWidth;</span><br><span class="line">    <span class="keyword">const</span> hasNewSliderHeight =</span><br><span class="line">      sliderHeight &amp;&amp; sliderHeight !== prevProps.sliderHeight;</span><br><span class="line">    <span class="keyword">const</span> hasNewItemWidth = itemWidth &amp;&amp; itemWidth !== prevProps.itemWidth;</span><br><span class="line">    <span class="keyword">const</span> hasNewItemHeight = itemHeight &amp;&amp; itemHeight !== prevProps.itemHeight;</span><br><span class="line">    <span class="keyword">const</span> hasNewScrollEnabled = scrollEnabled !== prevProps.scrollEnabled;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Prevent issues with dynamically removed items</span></span><br><span class="line">    <span class="keyword">if</span> (nextActiveItem &gt; itemsLength - <span class="number">1</span>) &#123;</span><br><span class="line">      nextActiveItem = itemsLength - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle changing scrollEnabled independent of user -&gt; carousel interaction</span></span><br><span class="line">    <span class="keyword">if</span> (hasNewScrollEnabled) &#123;</span><br><span class="line">      <span class="built_in">this</span>._setScrollEnabled(scrollEnabled);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      interpolators.length !== itemsLength ||</span><br><span class="line">      hasNewSliderWidth ||</span><br><span class="line">      hasNewSliderHeight ||</span><br><span class="line">      hasNewItemWidth ||</span><br><span class="line">      hasNewItemHeight</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="built_in">this</span>._activeItem = nextActiveItem;</span><br><span class="line">      <span class="built_in">this</span>._previousItemsLength = itemsLength;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>._initPositionsAndInterpolators(<span class="built_in">this</span>.props);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Handle scroll issue when dynamically removing items (see #133)</span></span><br><span class="line">      <span class="comment">// This also fixes first item&#x27;s active state on Android</span></span><br><span class="line">      <span class="comment">// Because &#x27;initialScrollIndex&#x27; apparently doesn&#x27;t trigger scroll</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>._previousItemsLength &gt; itemsLength) &#123;</span><br><span class="line">        <span class="built_in">this</span>._hackActiveSlideAnimation(nextActiveItem, <span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        hasNewSliderWidth ||</span><br><span class="line">        hasNewSliderHeight ||</span><br><span class="line">        hasNewItemWidth ||</span><br><span class="line">        hasNewItemHeight</span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="built_in">this</span>._snapToItem(nextActiveItem, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">      nextFirstItem !== <span class="built_in">this</span>._previousFirstItem &amp;&amp;</span><br><span class="line">      nextFirstItem !== <span class="built_in">this</span>._activeItem</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="built_in">this</span>._activeItem = nextFirstItem;</span><br><span class="line">      <span class="built_in">this</span>._previousFirstItem = nextFirstItem;</span><br><span class="line">      <span class="built_in">this</span>._snapToItem(nextFirstItem, <span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.props.onScroll !== prevProps.onScroll) &#123;</span><br><span class="line">      <span class="built_in">this</span>._setScrollHandler(<span class="built_in">this</span>.props);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清除定时器</span></span><br><span class="line">  <span class="function"><span class="title">componentWillUnmount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._mounted = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">this</span>.stopAutoplay();</span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>._apparitionTimeout);</span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>._hackSlideAnimationTimeout);</span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>._enableAutoplayTimeout);</span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>._autoplayTimeout);</span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>._snapNoMomentumTimeout);</span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>._edgeItemTimeout);</span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>._lockScrollTimeout);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 如果开启了loop，则根据loopClonesPerSide创建额外的元素</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">props</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_getCustomData</span>(<span class="params">props = <span class="built_in">this</span>.props</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data, loopClonesPerSide &#125; = props;</span><br><span class="line">    <span class="keyword">const</span> dataLength = data &amp;&amp; data.length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!dataLength) &#123;</span><br><span class="line">      <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>._enableLoop()) &#123;</span><br><span class="line">      <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> previousItems = [];</span><br><span class="line">    <span class="keyword">let</span> nextItems = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置loopClonesPerSide控制的两边渲染的元素数量，会修改data。</span></span><br><span class="line">    <span class="comment">// 修改之后data数组的索引和原本的会不同，因此后面的所有index操作都需要下面几个函数进行转换。即真实index和组件内index的对照</span></span><br><span class="line">    <span class="keyword">if</span> (loopClonesPerSide &gt; dataLength) &#123;</span><br><span class="line">      <span class="keyword">const</span> dataMultiplier = <span class="built_in">Math</span>.floor(loopClonesPerSide / dataLength);</span><br><span class="line">      <span class="keyword">const</span> remainder = loopClonesPerSide % dataLength;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dataMultiplier; i++) &#123;</span><br><span class="line">        previousItems.push(...data);</span><br><span class="line">        nextItems.push(...data);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      previousItems.unshift(...data.slice(-remainder));</span><br><span class="line">      nextItems.push(...data.slice(<span class="number">0</span>, remainder));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      previousItems = data.slice(-loopClonesPerSide);</span><br><span class="line">      nextItems = data.slice(<span class="number">0</span>, loopClonesPerSide);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> previousItems.concat(data, nextItems);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取数据长度，即data.length。如果开启loop那就要两边都加上loopClonesPerSide</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">props</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_getCustomDataLength</span>(<span class="params">props = <span class="built_in">this</span>.props</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data, loopClonesPerSide &#125; = props;</span><br><span class="line">    <span class="keyword">const</span> dataLength = data &amp;&amp; data.length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!dataLength) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._enableLoop() ? dataLength + <span class="number">2</span> * loopClonesPerSide : dataLength;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 从组件内index映射到customIndex，找到真实的index</span></span><br><span class="line">  <span class="function"><span class="title">_getCustomIndex</span>(<span class="params">index, props = <span class="built_in">this</span>.props</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> itemsLength = <span class="built_in">this</span>._getCustomDataLength(props);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!itemsLength || (!index &amp;&amp; index !== <span class="number">0</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._needsRTLAdaptations() ? itemsLength - index - <span class="number">1</span> : index;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上面函数的反向，从真实index转化到组件内的index，和customData能对应上</span></span><br><span class="line">  <span class="function"><span class="title">_getDataIndex</span>(<span class="params">index</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data, loopClonesPerSide &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> dataLength = data &amp;&amp; data.length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>._enableLoop() || !dataLength) &#123;</span><br><span class="line">      <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &gt;= dataLength + loopClonesPerSide) &#123;</span><br><span class="line">      <span class="keyword">return</span> loopClonesPerSide &gt; dataLength</span><br><span class="line">        ? (index - loopClonesPerSide) % dataLength</span><br><span class="line">        : index - dataLength - loopClonesPerSide;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index &lt; loopClonesPerSide) &#123;</span><br><span class="line">      <span class="keyword">if</span> (loopClonesPerSide &gt; dataLength) &#123;</span><br><span class="line">        <span class="keyword">const</span> baseDataIndexes = [];</span><br><span class="line">        <span class="keyword">const</span> dataIndexes = [];</span><br><span class="line">        <span class="keyword">const</span> dataMultiplier = <span class="built_in">Math</span>.floor(loopClonesPerSide / dataLength);</span><br><span class="line">        <span class="keyword">const</span> remainder = loopClonesPerSide % dataLength;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dataLength; i++) &#123;</span><br><span class="line">          baseDataIndexes.push(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; dataMultiplier; j++) &#123;</span><br><span class="line">          dataIndexes.push(...baseDataIndexes);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        dataIndexes.unshift(...baseDataIndexes.slice(-remainder));</span><br><span class="line">        <span class="keyword">return</span> dataIndexes[index];</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> index + dataLength - loopClonesPerSide;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> index - loopClonesPerSide;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 把输入的index转化为真实元素的index</span></span><br><span class="line"><span class="comment">   * 由于开启loop后会复制index，这里就是在做转化</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">index</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_getPositionIndex</span>(<span class="params">index</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; loop, loopClonesPerSide &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> loop ? index + loopClonesPerSide : index;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取第一个渲染的元素的真实index。参数是逻辑上的index</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;&#125;</span> <span class="variable">index</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">props</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_getFirstItem</span>(<span class="params">index, props = <span class="built_in">this</span>.props</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; loopClonesPerSide &#125; = props;</span><br><span class="line">    <span class="keyword">const</span> itemsLength = <span class="built_in">this</span>._getCustomDataLength(props);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!itemsLength || index &gt; itemsLength - <span class="number">1</span> || index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._enableLoop() ? index + loopClonesPerSide : index;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取轮播组件的ref，一般是ScrollView或FlatList的ref</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_getWrappedRef</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      <span class="built_in">this</span>._carouselRef &amp;&amp;</span><br><span class="line">      ((<span class="built_in">this</span>._needsScrollView() &amp;&amp; <span class="built_in">this</span>._carouselRef.scrollTo) ||</span><br><span class="line">        (!<span class="built_in">this</span>._needsScrollView() &amp;&amp; <span class="built_in">this</span>._carouselRef.scrollToOffset))</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>._carouselRef;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// https://github.com/facebook/react-native/issues/10635</span></span><br><span class="line">    <span class="comment">// https://stackoverflow.com/a/48786374/8412141</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="built_in">this</span>._carouselRef &amp;&amp;</span><br><span class="line">      <span class="built_in">this</span>._carouselRef.getNode &amp;&amp;</span><br><span class="line">      <span class="built_in">this</span>._carouselRef.getNode()</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取ScrollView或FlatList的ScrollOffset，用于用户滚动事件的计算</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">event</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_getScrollOffset</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; vertical &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      (event &amp;&amp;</span><br><span class="line">        event.nativeEvent &amp;&amp;</span><br><span class="line">        event.nativeEvent.contentOffset &amp;&amp;</span><br><span class="line">        event.nativeEvent.contentOffset[vertical ? <span class="string">&quot;y&quot;</span> : <span class="string">&quot;x&quot;</span>]) ||</span><br><span class="line">      <span class="number">0</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 容器内部的两侧边距，相当于item和Carousel的间距</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">opposite</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_getContainerInnerMargin</span>(<span class="params">opposite = <span class="literal">false</span></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      sliderWidth,</span><br><span class="line">      sliderHeight,</span><br><span class="line">      itemWidth,</span><br><span class="line">      itemHeight,</span><br><span class="line">      vertical,</span><br><span class="line">      activeSlideAlignment,</span><br><span class="line">    &#125; = <span class="built_in">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      (activeSlideAlignment === <span class="string">&quot;start&quot;</span> &amp;&amp; !opposite) ||</span><br><span class="line">      (activeSlideAlignment === <span class="string">&quot;end&quot;</span> &amp;&amp; opposite)</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">      (activeSlideAlignment === <span class="string">&quot;end&quot;</span> &amp;&amp; !opposite) ||</span><br><span class="line">      (activeSlideAlignment === <span class="string">&quot;start&quot;</span> &amp;&amp; opposite)</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> vertical ? sliderHeight - itemHeight : sliderWidth - itemWidth;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> vertical</span><br><span class="line">        ? (sliderHeight - itemHeight) / <span class="number">2</span></span><br><span class="line">        : (sliderWidth - itemWidth) / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 如果选定中间对齐，那么就是sliderWidth/2，相当于轮播图容器的中间位置</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_getViewportOffset</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      sliderWidth,</span><br><span class="line">      sliderHeight,</span><br><span class="line">      itemWidth,</span><br><span class="line">      itemHeight,</span><br><span class="line">      vertical,</span><br><span class="line">      activeSlideAlignment,</span><br><span class="line">    &#125; = <span class="built_in">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (activeSlideAlignment === <span class="string">&quot;start&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> vertical ? itemHeight / <span class="number">2</span> : itemWidth / <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeSlideAlignment === <span class="string">&quot;end&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> vertical</span><br><span class="line">        ? sliderHeight - itemHeight / <span class="number">2</span></span><br><span class="line">        : sliderWidth - itemWidth / <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> vertical ? sliderHeight / <span class="number">2</span> : sliderWidth / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取中心位置的偏移量，根据ScrollView当前的偏移量得出</span></span><br><span class="line"><span class="comment">   * 传入的offset是ScrollView等容器当前的偏移，得出的是在这个偏移基础上，视图上的中间位置，一般就是在偏移量上加上sliderWidth / 2</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">offset</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_getCenter</span>(<span class="params">offset</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> offset + <span class="built_in">this</span>._getViewportOffset() - <span class="built_in">this</span>._getContainerInnerMargin();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取当前在中心的item。遍历_positions数组找到在中心位置的元素</span></span><br><span class="line"><span class="comment">   * 参数offset是当前ScrollView或FlatList的滚动offset，根据这个找到最近的一个元素</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">offset</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_getActiveItem</span>(<span class="params">offset</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; activeSlideOffset, swipeThreshold &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> center = <span class="built_in">this</span>._getCenter(offset); <span class="comment">//</span></span><br><span class="line">    <span class="keyword">const</span> centerOffset = activeSlideOffset || swipeThreshold;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里是定位元素的关键</span></span><br><span class="line">    <span class="comment">// 如果没有centerOffset，那么确定当前是哪个元素的方法就是center &gt;= start &amp;&amp; center &lt;= end，即center应该在元素的宽度范围内</span></span><br><span class="line">    <span class="comment">// 加上了centerOffset，其实是缩小了范围，相当于center &gt;= start - centerOffset &amp;&amp; center &lt;= end + centerOffset，这样可能移动更小的距离就会到下一个元素去</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>._positions.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; start, end &#125; = <span class="built_in">this</span>._positions[i];</span><br><span class="line">      <span class="keyword">if</span> (center + centerOffset &gt;= start &amp;&amp; center - centerOffset &lt;= end) &#123;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> lastIndex = <span class="built_in">this</span>._positions.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      <span class="built_in">this</span>._positions[lastIndex] &amp;&amp;</span><br><span class="line">      center - centerOffset &gt; <span class="built_in">this</span>._positions[lastIndex].end</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> lastIndex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 初始化各个元素的位置信息，设置插值动画</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">props</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_initPositionsAndInterpolators</span>(<span class="params">props = <span class="built_in">this</span>.props</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data, itemWidth, itemHeight, scrollInterpolator, vertical &#125; = props;</span><br><span class="line">    <span class="keyword">const</span> sizeRef = vertical ? itemHeight : itemWidth;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!data || !data.length) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> interpolators = [];</span><br><span class="line">    <span class="built_in">this</span>._positions = [];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>._getCustomData(props).forEach(<span class="function">(<span class="params">itemData, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 这里的index是不真实的index，是复制过后的，但在布局中是基准</span></span><br><span class="line">      <span class="comment">// _index才是原本在data中的index</span></span><br><span class="line">      <span class="keyword">const</span> _index = <span class="built_in">this</span>._getCustomIndex(index, props);</span><br><span class="line">      <span class="keyword">let</span> animatedValue;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>._positions[index] = &#123;</span><br><span class="line">        <span class="attr">start</span>: index * sizeRef,</span><br><span class="line">        <span class="attr">end</span>: index * sizeRef + sizeRef,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">this</span>._shouldAnimateSlides(props)) &#123;</span><br><span class="line">        animatedValue = <span class="keyword">new</span> Animated.Value(<span class="number">1</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>._shouldUseCustomAnimation()) &#123;</span><br><span class="line">        animatedValue = <span class="keyword">new</span> Animated.Value(_index === <span class="built_in">this</span>._activeItem ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> interpolator;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (scrollInterpolator) &#123;</span><br><span class="line">          interpolator = scrollInterpolator(_index, props);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>._shouldUseStackLayout()) &#123;</span><br><span class="line">          interpolator = stackScrollInterpolator(_index, props);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>._shouldUseTinderLayout()) &#123;</span><br><span class="line">          interpolator = tinderScrollInterpolator(_index, props);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          !interpolator ||</span><br><span class="line">          !interpolator.inputRange ||</span><br><span class="line">          !interpolator.outputRange</span><br><span class="line">        ) &#123;</span><br><span class="line">          interpolator = defaultScrollInterpolator(_index, props);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        animatedValue = <span class="built_in">this</span>._scrollPos.interpolate(&#123;</span><br><span class="line">          ...interpolator,</span><br><span class="line">          <span class="attr">extrapolate</span>: <span class="string">&quot;clamp&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      interpolators.push(animatedValue);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.setState(&#123; interpolators &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 滚动到指定的offset</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">offset</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">animated</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_scrollTo</span>(<span class="params">offset, animated = <span class="literal">true</span></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; vertical &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> wrappedRef = <span class="built_in">this</span>._getWrappedRef();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>._mounted || !wrappedRef) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> specificOptions = <span class="built_in">this</span>._needsScrollView()</span><br><span class="line">      ? &#123;</span><br><span class="line">          <span class="attr">x</span>: vertical ? <span class="number">0</span> : offset,</span><br><span class="line">          <span class="attr">y</span>: vertical ? offset : <span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      : &#123;</span><br><span class="line">          offset,</span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="keyword">const</span> options = &#123;</span><br><span class="line">      ...specificOptions,</span><br><span class="line">      animated,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._needsScrollView()) &#123;</span><br><span class="line">      wrappedRef.scrollTo(options);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      wrappedRef.scrollToOffset(options);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这里是用户滚动事件的监听回调，这个onScroll会被传递给ScrollView</span></span><br><span class="line">  <span class="function"><span class="title">_onScroll</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; callbackOffsetMargin, enableMomentum, onScroll &#125; = <span class="built_in">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> scrollOffset = event</span><br><span class="line">      ? <span class="built_in">this</span>._getScrollOffset(event)</span><br><span class="line">      : <span class="built_in">this</span>._currentContentOffset;</span><br><span class="line">    <span class="keyword">const</span> nextActiveItem = <span class="built_in">this</span>._getActiveItem(scrollOffset);</span><br><span class="line">    <span class="keyword">const</span> itemReached = nextActiveItem === <span class="built_in">this</span>._itemToSnapTo;</span><br><span class="line">    <span class="keyword">const</span> scrollConditions =</span><br><span class="line">      scrollOffset &gt;= <span class="built_in">this</span>._scrollOffsetRef - callbackOffsetMargin &amp;&amp;</span><br><span class="line">      scrollOffset &lt;= <span class="built_in">this</span>._scrollOffsetRef + callbackOffsetMargin;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>._currentContentOffset = scrollOffset;</span><br><span class="line">    <span class="built_in">this</span>._onScrollTriggered = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">this</span>._lastScrollDate = <span class="built_in">Date</span>.now();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._activeItem !== nextActiveItem &amp;&amp; itemReached) &#123;</span><br><span class="line">      <span class="keyword">if</span> (scrollConditions) &#123;</span><br><span class="line">        <span class="built_in">this</span>._activeItem = nextActiveItem;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>._canFireCallback) &#123;</span><br><span class="line">          <span class="comment">// 滚动到指定元素</span></span><br><span class="line">          <span class="built_in">this</span>._onSnap(<span class="built_in">this</span>._getDataIndex(nextActiveItem));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这个方法同样是会传递给ScrollView，表示用户的滚动操作结束</span></span><br><span class="line">  <span class="function"><span class="title">_onScrollEnd</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; autoplayDelay, enableSnap &#125; = <span class="built_in">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._currentContentOffset === <span class="built_in">this</span>._scrollEndOffset) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>._scrollEndOffset = <span class="built_in">this</span>._currentContentOffset;</span><br><span class="line">    <span class="built_in">this</span>._scrollEndActive = <span class="built_in">this</span>._getActiveItem(<span class="built_in">this</span>._scrollEndOffset);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (enableSnap) &#123;</span><br><span class="line">      <span class="comment">// 这里会执行滚动</span></span><br><span class="line">      <span class="built_in">this</span>._snapScroll(<span class="built_in">this</span>._scrollEndOffset - <span class="built_in">this</span>._scrollStartOffset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._autoplay &amp;&amp; !<span class="built_in">this</span>._autoplaying) &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>._enableAutoplayTimeout);</span><br><span class="line">      <span class="built_in">this</span>._enableAutoplayTimeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.startAutoplay();</span><br><span class="line">      &#125;, autoplayDelay + <span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="title">_snapScroll</span>(<span class="params">delta</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; swipeThreshold &#125; = <span class="built_in">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>._scrollEndActive &amp;&amp; <span class="built_in">this</span>._scrollEndActive !== <span class="number">0</span> &amp;&amp; IS_IOS) &#123;</span><br><span class="line">      <span class="built_in">this</span>._scrollEndActive = <span class="built_in">this</span>._scrollStartActive;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._scrollStartActive !== <span class="built_in">this</span>._scrollEndActive) &#123;</span><br><span class="line">      <span class="comment">// 滚动到下一个元素</span></span><br><span class="line">      <span class="built_in">this</span>._snapToItem(<span class="built_in">this</span>._scrollEndActive);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 按照偏移量滚动。可以看出这里不管偏移量有多少，最多也只能滚动一个</span></span><br><span class="line">      <span class="keyword">if</span> (delta &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &gt; swipeThreshold) &#123;</span><br><span class="line">          <span class="built_in">this</span>._snapToItem(<span class="built_in">this</span>._scrollStartActive + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>._snapToItem(<span class="built_in">this</span>._scrollEndActive);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; -swipeThreshold) &#123;</span><br><span class="line">          <span class="built_in">this</span>._snapToItem(<span class="built_in">this</span>._scrollStartActive - <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>._snapToItem(<span class="built_in">this</span>._scrollEndActive);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>._snapToItem(<span class="built_in">this</span>._scrollEndActive);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 通过index移动到指定的item，关键函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">index</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">animated</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">fireCallback</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">initial</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">lockScroll</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_snapToItem</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    index,</span></span></span><br><span class="line"><span class="params"><span class="function">    animated = <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    fireCallback = <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    initial = <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    lockScroll = <span class="literal">true</span></span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; enableMomentum, onSnapToItem, onBeforeSnapToItem &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> itemsLength = <span class="built_in">this</span>._getCustomDataLength();</span><br><span class="line">    <span class="keyword">const</span> wrappedRef = <span class="built_in">this</span>._getWrappedRef();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!itemsLength || !wrappedRef) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!index || index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      index = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (itemsLength &gt; <span class="number">0</span> &amp;&amp; index &gt;= itemsLength) &#123;</span><br><span class="line">      index = itemsLength - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>._itemToSnapTo = index;</span><br><span class="line">    <span class="comment">// 通过positions数组获取到指定元素的start和end偏移量</span></span><br><span class="line">    <span class="built_in">this</span>._scrollOffsetRef =</span><br><span class="line">      <span class="built_in">this</span>._positions[index] &amp;&amp; <span class="built_in">this</span>._positions[index].start;</span><br><span class="line">    <span class="built_in">this</span>._onScrollTriggered = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>._scrollOffsetRef &amp;&amp; <span class="built_in">this</span>._scrollOffsetRef !== <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 滚动到指定偏移位置</span></span><br><span class="line">    <span class="built_in">this</span>._scrollTo(<span class="built_in">this</span>._scrollOffsetRef, animated);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>._scrollEndOffset = <span class="built_in">this</span>._currentContentOffset;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">startAutoplay</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; autoplayInterval, autoplayDelay &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="built_in">this</span>._autoplay = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._autoplaying) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>._autoplayTimeout);</span><br><span class="line">    <span class="built_in">this</span>._autoplayTimeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>._autoplaying = <span class="literal">true</span>;</span><br><span class="line">      <span class="built_in">this</span>._autoplayInterval = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>._autoplaying) &#123;</span><br><span class="line">          <span class="built_in">this</span>.snapToNext();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, autoplayInterval);</span><br><span class="line">    &#125;, autoplayDelay);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">pauseAutoPlay</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._autoplaying = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>._autoplayTimeout);</span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>._enableAutoplayTimeout);</span><br><span class="line">    <span class="built_in">clearInterval</span>(<span class="built_in">this</span>._autoplayInterval);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">stopAutoplay</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._autoplay = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">this</span>.pauseAutoPlay();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 这个是暴露为props的函数，index需要和真实的index进行转换</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">index</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">animated</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">fireCallback</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">snapToItem</span>(<span class="params">index, animated = <span class="literal">true</span>, fireCallback = <span class="literal">true</span></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!index || index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      index = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> positionIndex = <span class="built_in">this</span>._getPositionIndex(index);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (positionIndex === <span class="built_in">this</span>._activeItem) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>._snapToItem(positionIndex, animated, fireCallback);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">snapToNext</span>(<span class="params">animated = <span class="literal">true</span>, fireCallback = <span class="literal">true</span></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> itemsLength = <span class="built_in">this</span>._getCustomDataLength();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newIndex = <span class="built_in">this</span>._activeItem + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (newIndex &gt; itemsLength - <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">this</span>._enableLoop()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 这里的loop实际上就是在index超出时，将newIndex归为0</span></span><br><span class="line">      <span class="comment">// 然后执行一个不包含动画的scrollTo，就可以实现滚动效果了</span></span><br><span class="line">      newIndex = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>._snapToItem(newIndex, animated, fireCallback);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">snapToPrev</span>(<span class="params">animated = <span class="literal">true</span>, fireCallback = <span class="literal">true</span></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> itemsLength = <span class="built_in">this</span>._getCustomDataLength();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newIndex = <span class="built_in">this</span>._activeItem - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (newIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">this</span>._enableLoop()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      newIndex = itemsLength - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>._snapToItem(newIndex, animated, fireCallback);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="title">_getSlideInterpolatedStyle</span>(<span class="params">index, animatedValue</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; layoutCardOffset, slideInterpolatedStyle &#125; = <span class="built_in">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (slideInterpolatedStyle) &#123;</span><br><span class="line">      <span class="keyword">return</span> slideInterpolatedStyle(index, animatedValue, <span class="built_in">this</span>.props);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>._shouldUseTinderLayout()) &#123;</span><br><span class="line">      <span class="keyword">return</span> tinderAnimatedStyles(</span><br><span class="line">        index,</span><br><span class="line">        animatedValue,</span><br><span class="line">        <span class="built_in">this</span>.props,</span><br><span class="line">        layoutCardOffset</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>._shouldUseStackLayout()) &#123;</span><br><span class="line">      <span class="keyword">return</span> stackAnimatedStyles(</span><br><span class="line">        index,</span><br><span class="line">        animatedValue,</span><br><span class="line">        <span class="built_in">this</span>.props,</span><br><span class="line">        layoutCardOffset</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>._shouldUseShiftLayout()) &#123;</span><br><span class="line">      <span class="keyword">return</span> shiftAnimatedStyles(index, animatedValue, <span class="built_in">this</span>.props);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> defaultAnimatedStyles(index, animatedValue, <span class="built_in">this</span>.props);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">_renderItem</span>(<span class="params">&#123; item, index &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; interpolators &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      hasParallaxImages,</span><br><span class="line">      itemWidth,</span><br><span class="line">      itemHeight,</span><br><span class="line">      keyExtractor,</span><br><span class="line">      renderItem,</span><br><span class="line">      sliderHeight,</span><br><span class="line">      sliderWidth,</span><br><span class="line">      slideStyle,</span><br><span class="line">      vertical,</span><br><span class="line">    &#125; = <span class="built_in">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> animatedValue = interpolators &amp;&amp; interpolators[index];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!animatedValue &amp;&amp; animatedValue !== <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> animate = <span class="built_in">this</span>._shouldAnimateSlides();</span><br><span class="line">    <span class="keyword">const</span> Component = animate ? Animated.View : View;</span><br><span class="line">    <span class="keyword">const</span> animatedStyle = animate</span><br><span class="line">      ? <span class="built_in">this</span>._getSlideInterpolatedStyle(index, animatedValue)</span><br><span class="line">      : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> parallaxProps = hasParallaxImages</span><br><span class="line">      ? &#123;</span><br><span class="line">          <span class="attr">scrollPosition</span>: <span class="built_in">this</span>._scrollPos,</span><br><span class="line">          <span class="attr">carouselRef</span>: <span class="built_in">this</span>._carouselRef,</span><br><span class="line">          vertical,</span><br><span class="line">          sliderWidth,</span><br><span class="line">          sliderHeight,</span><br><span class="line">          itemWidth,</span><br><span class="line">          itemHeight,</span><br><span class="line">        &#125;</span><br><span class="line">      : <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每个渲染的组件被View包裹，View设置指定的itemWidth</span></span><br><span class="line">    <span class="keyword">const</span> mainDimension = vertical</span><br><span class="line">      ? &#123; <span class="attr">height</span>: itemHeight &#125;</span><br><span class="line">      : &#123; <span class="attr">width</span>: itemWidth &#125;;</span><br><span class="line">    <span class="keyword">const</span> specificProps = <span class="built_in">this</span>._needsScrollView()</span><br><span class="line">      ? &#123;</span><br><span class="line">          <span class="attr">key</span>: keyExtractor</span><br><span class="line">            ? keyExtractor(item, index)</span><br><span class="line">            : <span class="built_in">this</span>._getKeyExtractor(item, index),</span><br><span class="line">        &#125;</span><br><span class="line">      : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里通过包裹一层View的形式控制每个元素的宽度为itemWidth，并且包含了动画样式</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Component</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">style</span>=<span class="string">&#123;[mainDimension,</span> <span class="attr">slideStyle</span>, <span class="attr">animatedStyle</span>]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">pointerEvents</span>=<span class="string">&#123;</span>&quot;<span class="attr">box-none</span>&quot;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">        &#123;<span class="attr">...specificProps</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">      &gt;</span></span></span><br><span class="line"><span class="xml">        &#123;renderItem(&#123; item, index &#125;, parallaxProps)&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Component</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 配置ScrollView或FlatList需要的属性，如initialNumToRender</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_getComponentOverridableProps</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      enableMomentum,</span><br><span class="line">      itemWidth,</span><br><span class="line">      itemHeight,</span><br><span class="line">      loopClonesPerSide,</span><br><span class="line">      sliderWidth,</span><br><span class="line">      sliderHeight,</span><br><span class="line">      vertical,</span><br><span class="line">    &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="comment">// 根据设置的宽度确定能显示的元素数量</span></span><br><span class="line">    <span class="keyword">const</span> visibleItems =</span><br><span class="line">      <span class="built_in">Math</span>.ceil(</span><br><span class="line">        vertical ? sliderHeight / itemHeight : sliderWidth / itemWidth</span><br><span class="line">      ) + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> initialNumPerSide = <span class="built_in">this</span>._enableLoop() ? loopClonesPerSide : <span class="number">2</span>; <span class="comment">// 每边初始渲染的数量，默认为2</span></span><br><span class="line">    <span class="comment">// 初始渲染的总数量，即可见元素数量 + 每边额外渲染的数量 * 2</span></span><br><span class="line">    <span class="comment">// 这个值将会直接给到FlatList</span></span><br><span class="line">    <span class="keyword">const</span> initialNumToRender = visibleItems + initialNumPerSide * <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">const</span> maxToRenderPerBatch = <span class="number">1</span> + initialNumToRender * <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// 可视区域外最大能被渲染的数量，等于初始渲染数量 * 2 + 1</span></span><br><span class="line">    <span class="keyword">const</span> windowSize = maxToRenderPerBatch;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> specificProps = !<span class="built_in">this</span>._needsScrollView()</span><br><span class="line">      ? &#123;</span><br><span class="line">          <span class="attr">initialNumToRender</span>: initialNumToRender,</span><br><span class="line">          <span class="attr">maxToRenderPerBatch</span>: maxToRenderPerBatch,</span><br><span class="line">          <span class="attr">windowSize</span>: windowSize,</span><br><span class="line">          <span class="comment">// updateCellsBatchingPeriod</span></span><br><span class="line">        &#125;</span><br><span class="line">      : &#123;&#125;;</span><br><span class="line">    <span class="comment">// 这些props交给ScrollView或FlatList</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">decelerationRate</span>: enableMomentum ? <span class="number">0.9</span> : <span class="string">&quot;fast&quot;</span>,</span><br><span class="line">      <span class="attr">showsHorizontalScrollIndicator</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">showsVerticalScrollIndicator</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">overScrollMode</span>: <span class="string">&quot;never&quot;</span>,</span><br><span class="line">      <span class="attr">automaticallyAdjustContentInsets</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">directionalLockEnabled</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">pinchGestureEnabled</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">scrollsToTop</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">removeClippedSubviews</span>: !<span class="built_in">this</span>._needsScrollView(),</span><br><span class="line">      <span class="attr">inverted</span>: <span class="built_in">this</span>._needsRTLAdaptations(),</span><br><span class="line">      <span class="comment">// renderToHardwareTextureAndroid: true,</span></span><br><span class="line">      ...specificProps,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 主要配置一些样式属性，以及安装renderItem等回调</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_getComponentStaticProps</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; hideCarousel &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      containerCustomStyle,</span><br><span class="line">      contentContainerCustomStyle,</span><br><span class="line">      keyExtractor,</span><br><span class="line">      sliderWidth,</span><br><span class="line">      sliderHeight,</span><br><span class="line">      style,</span><br><span class="line">      vertical,</span><br><span class="line">    &#125; = <span class="built_in">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> containerStyle = [</span><br><span class="line">      containerCustomStyle || style || &#123;&#125;,</span><br><span class="line">      hideCarousel ? &#123; <span class="attr">opacity</span>: <span class="number">0</span> &#125; : &#123;&#125;,</span><br><span class="line">      vertical</span><br><span class="line">        ? &#123; <span class="attr">height</span>: sliderHeight, <span class="attr">flexDirection</span>: <span class="string">&quot;column&quot;</span> &#125;</span><br><span class="line">        : <span class="comment">// LTR hack; see https://github.com/facebook/react-native/issues/11960</span></span><br><span class="line">          <span class="comment">// and https://github.com/facebook/react-native/issues/13100#issuecomment-328986423</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">width</span>: sliderWidth,</span><br><span class="line">            <span class="attr">flexDirection</span>: <span class="built_in">this</span>._needsRTLAdaptations() ? <span class="string">&quot;row-reverse&quot;</span> : <span class="string">&quot;row&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">const</span> contentContainerStyle = [</span><br><span class="line">      vertical</span><br><span class="line">        ? &#123;</span><br><span class="line">            <span class="attr">paddingTop</span>: <span class="built_in">this</span>._getContainerInnerMargin(),</span><br><span class="line">            <span class="attr">paddingBottom</span>: <span class="built_in">this</span>._getContainerInnerMargin(<span class="literal">true</span>),</span><br><span class="line">          &#125;</span><br><span class="line">        : &#123;</span><br><span class="line">            <span class="attr">paddingLeft</span>: <span class="built_in">this</span>._getContainerInnerMargin(),</span><br><span class="line">            <span class="attr">paddingRight</span>: <span class="built_in">this</span>._getContainerInnerMargin(<span class="literal">true</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">      contentContainerCustomStyle || &#123;&#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> specificProps = !<span class="built_in">this</span>._needsScrollView()</span><br><span class="line">      ? &#123;</span><br><span class="line">          <span class="comment">// extraData: this.state,</span></span><br><span class="line">          <span class="attr">renderItem</span>: <span class="built_in">this</span>._renderItem,</span><br><span class="line">          <span class="attr">numColumns</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">keyExtractor</span>: keyExtractor || <span class="built_in">this</span>._getKeyExtractor,</span><br><span class="line">        &#125;</span><br><span class="line">      : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">ref</span>: <span class="function">(<span class="params">c</span>) =&gt;</span> (<span class="built_in">this</span>._carouselRef = c),</span><br><span class="line">      <span class="attr">data</span>: <span class="built_in">this</span>._getCustomData(),</span><br><span class="line">      <span class="attr">style</span>: containerStyle,</span><br><span class="line">      <span class="attr">contentContainerStyle</span>: contentContainerStyle,</span><br><span class="line">      <span class="attr">horizontal</span>: !vertical,</span><br><span class="line">      <span class="attr">scrollEventThrottle</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">onScroll</span>: <span class="built_in">this</span>._onScrollHandler,</span><br><span class="line">      <span class="attr">onScrollBeginDrag</span>: <span class="built_in">this</span>._onScrollBeginDrag,</span><br><span class="line">      <span class="attr">onScrollEndDrag</span>: <span class="built_in">this</span>._onScrollEndDrag,</span><br><span class="line">      <span class="attr">onMomentumScrollEnd</span>: <span class="built_in">this</span>._onMomentumScrollEnd,</span><br><span class="line">      <span class="attr">onResponderRelease</span>: <span class="built_in">this</span>._onTouchRelease,</span><br><span class="line">      <span class="attr">onStartShouldSetResponderCapture</span>: <span class="built_in">this</span>._onStartShouldSetResponderCapture,</span><br><span class="line">      <span class="attr">onTouchStart</span>: <span class="built_in">this</span>._onTouchStart,</span><br><span class="line">      <span class="attr">onTouchEnd</span>: <span class="built_in">this</span>._onScrollEnd,</span><br><span class="line">      <span class="attr">onLayout</span>: <span class="built_in">this</span>._onLayout,</span><br><span class="line">      ...specificProps,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data, renderItem, useScrollView &#125; = <span class="built_in">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!data || !renderItem) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> props = &#123;</span><br><span class="line">      ...this._getComponentOverridableProps(),</span><br><span class="line">      ...this.props,</span><br><span class="line">      ...this._getComponentStaticProps(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> ScrollViewComponent =</span><br><span class="line">      <span class="keyword">typeof</span> useScrollView === <span class="string">&quot;function&quot;</span> ? useScrollView : AnimatedScrollView;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._needsScrollView() ? (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">ScrollViewComponent</span> &#123;<span class="attr">...props</span>&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;this._getCustomData().map((item, index) =&gt; &#123;</span></span><br><span class="line"><span class="xml">          return this._renderItem(&#123; item, index &#125;);</span></span><br><span class="line"><span class="xml">        &#125;)&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">ScrollViewComponent</span>&gt;</span></span></span><br><span class="line">    ) : (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">AnimatedFlatList</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/codes1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/07/08/readme/"><img class="next-cover" src="/img/codes1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info"></div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/pinkstar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Xing Ye</div><div class="author-info__description">a singleThreaded boy's blog</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/penghei"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/penghei" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:632885485@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">A SingleThreaded Boy...</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/07/17/carousel-source-code/" title="无题"><img src="/img/codes1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2023/07/17/carousel-source-code/" title="无题">无题</a><time datetime="2023-07-16T17:12:50.276Z" title="发表于 2023-07-17 01:12:50">2023-07-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/08/readme/" title="无题"><img src="/img/codes1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2023/07/08/readme/" title="无题">无题</a><time datetime="2023-07-07T18:59:52.412Z" title="发表于 2023-07-08 02:59:52">2023-07-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/30/react-priority/" title="使用Priority管理React组件渲染优先级"><img src="/img/codes1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用Priority管理React组件渲染优先级"/></a><div class="content"><a class="title" href="/2023/06/30/react-priority/" title="使用Priority管理React组件渲染优先级">使用Priority管理React组件渲染优先级</a><time datetime="2023-06-30T06:58:28.000Z" title="发表于 2023-06-30 14:58:28">2023-06-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/17/react-native/" title="React Native 学习"><img src="/img/codes1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="React Native 学习"/></a><div class="content"><a class="title" href="/2023/05/17/react-native/" title="React Native 学习">React Native 学习</a><time datetime="2023-05-17T06:58:28.000Z" title="发表于 2023-05-17 14:58:28">2023-05-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/05/konva/" title="konva学习和原理浅析"><img src="/img/codes1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="konva学习和原理浅析"/></a><div class="content"><a class="title" href="/2023/03/05/konva/" title="konva学习和原理浅析">konva学习和原理浅析</a><time datetime="2023-03-05T09:23:35.000Z" title="发表于 2023-03-05 17:23:35">2023-03-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Xing Ye</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hello stranger!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>